---
published: true
title: Understanding mysterious google cloud authentication
---

Authentication is the more frustating part of google cloud at first. 
It seems really complicated with various system, a terminology that at first we do not understand. 

Let's list a few facts, we have understood. 

### Enabling the API's and discovering API manager

* Accessing  the api guide [https://cloud.google.com/appengine/docs/admin-api/accessing-the-api](https://cloud.google.com/appengine/docs/admin-api/accessing-the-api)

the tutorial suggest you 
> Enable both the Google App Engine Admin API and Google Cloud Storage API in your Cloud Platform project:

So : 
* Api's are not enabled by default
* there is 2 concepts : 
   * google cloud storage : for storing static files
   * google app engine : to compute app like a virtual machine
   
When clicking on the enable [all apis  button](https://console.cloud.google.com/flows/enableapi?apiid=appengine,storage_component) 

I notice a panel that is about APIS

![API panel]({{site.baseurl}}/_posts/Screen Shot 2016-12-27 at 00.36.10.png)

That go to a page dedicated to all APIs. Not only the 2 mentioned, but more APIS that are in those 2 groups of APIS- storage and compute.

![Google cloud APIS]({{site.baseurl}}/_posts/Screen Shot 2016-12-27 at 00.34.18.png)

This page is also accessible via a side menu. 

![Gcloud side menu]({{site.baseurl}}/_posts/Screen Shot 2016-12-27 at 00.36.29.png)

Once in the APIs Manager page, you have a credentials menu item.

![Credentials gcloud]({{site.baseurl}}/_posts/Screen Shot 2016-12-27 at 00.42.29.png)

The last item of this menu offer to help choose. Good idea!

You can access this wizard directly at this [link](https://console.cloud.google.com/apis/credentials/wizard).


### What type of authentication? 

There is 3 types : 

* API keys : A simple  API key. Some were already generated by the browser or the server (per aps by firebase) in my case. 
* OAuth 2.0 client IDs : A way to create an account on you site thanks to their google login (for your app users) 
* Service account keys : A variant or API keys?


For the case of a server that want to have access to the app.
I ended with the concept of **Application Default Credentials**.
Documented in this [page](https://developers.google.com/identity/protocols/application-default-credentials?hl=en_US).

I am interested in the node.js version 

It use a library :   
[https://github.com/google/google-api-nodejs-client](https://github.com/google/google-api-nodejs-client) which is global to all google APIs.

> Google's officially supported Node.js client library for accessing Google APIs. Support for authorization and authentication with OAuth 2.0, API Keys and JWT (Service Tokens) is included

So let's install it : 

`npm install googleapis --save`

Another place to look at is this page 

[https://developers.google.com/identity/](https://developers.google.com/identity/)

Which is the identification temple of google!
All google methods to authenticate. 

Among which this mysterious **Application Default Credentials**.

After reading a bit, it seems there is another node.js more specific library only for google authentication. 

Let's use it, as its doc should be clearer (as it is more specific) 

> This is Google's officially supported node.js client library for using OAuth 2.0 authorization and authentication with Google APIs.

[https://github.com/google/google-auth-library-nodejs](https://github.com/google/google-auth-library-nodejs)







   


