---
published: true
title: Understanding mysterious google cloud authentication
---

Authentication is the more frustating part of google cloud at first.
It seems really complicated with various system, a terminology that at first we do not understand.

Let's list a few facts, we have understood.

## Enabling the API's and discovering API manager

* Accessing  the api guide [https://cloud.google.com/appengine/docs/admin-api/accessing-the-api](https://cloud.google.com/appengine/docs/admin-api/accessing-the-api)

the tutorial suggest you
> Enable both the Google App Engine Admin API and Google Cloud Storage API in your Cloud Platform project:

So :

* Api's are not enabled by default
* there is 2 concepts :
   * google cloud storage : for storing static files
   * google app engine : to compute app like a virtual machine

When clicking on the enable [all apis  button](https://console.cloud.google.com/flows/enableapi?apiid=appengine,storage_component)

I notice a panel that is about APIS

![API panel]({{site.baseurl}}/images/gcloud-api-panel.png)

That go to a page dedicated to all APIs. Not only the 2 mentioned, but more APIS that are in those 2 groups of APIS- storage and compute.

![Google cloud APIS]({{site.baseurl}}/images/gcloud-api.png)

This page is also accessible via a side menu.

![Gcloud side menu]({{site.baseurl}}/images/gcloud-side-menu.png)

Once in the APIs Manager page, you have a credentials menu item.

![Credentials gcloud]({{site.baseurl}}/images/gcloud-credential-wizard.png)

The last item of this menu offer to help choose. Good idea!

You can access this wizard directly at this [link](https://console.cloud.google.com/apis/credentials/wizard).


## What type of authentication?

There is 3 types :

* API keys : A simple  API key. Some were already generated by the browser or the server (per aps by firebase) in my case.
* OAuth 2.0 client IDs : A way to create an account on you site thanks to their google login (for your app users)
* Service account keys : A variant or API keys?

## What is Application Default Credentials?

For the case of a server that want to have access to the app.
I ended with the concept of **Application Default Credentials**.
Documented in this [page](https://developers.google.com/identity/protocols/application-default-credentials?hl=en_US).

I am interested in the [node.js version](https://developers.google.com/identity/protocols/application-default-credentials#callingnode)

It use a library :   
[https://github.com/google/google-api-nodejs-client](https://github.com/google/google-api-nodejs-client) which is global to all google APIs.

> Google's officially supported Node.js client library for accessing Google APIs. Support for authorization and authentication with OAuth 2.0, API Keys and JWT (Service Tokens) is included

So let's install it :

`npm install googleapis --save`

Another place to look at is this page

[https://developers.google.com/identity/](https://developers.google.com/identity/)

Which is the identification temple of google!
All google methods to authenticate.

Among which this mysterious **Application Default Credentials**.

After reading a bit, it seems there is another node.js more specific library only for google authentication.

Let's use it, as its doc should be clearer (as it is more specific)

> This is Google's officially supported node.js client library for using OAuth 2.0 authorization and authentication with Google APIs.

[https://github.com/google/google-auth-library-nodejs](https://github.com/google/google-auth-library-nodejs)

So again :

`npm install google-auth-library --save`

## On the road to google cloud library

While reading a [discussion](https://groups.google.com/forum/#!topic/firebase-talk/13kBF0PpmQA) on how to use google storage instead of firebase (which does not have a SDK yet in node.js)
[https://github.com/GoogleCloudPlatform/google-cloud-node](https://github.com/GoogleCloudPlatform/google-cloud-node)

So let's sum up :

* [https://github.com/google/google-api-nodejs-client](https://github.com/google/google-api-nodejs-client) Manage all google apis with node.js app indepently of gcloud
* [https://github.com/google/google-auth-library-nodejs](https://github.com/google/google-auth-library-nodejs) Manage only the authentication in the  context of gcloud or not
* [https://github.com/GoogleCloudPlatform/google-cloud-node](https://github.com/GoogleCloudPlatform/google-cloud-node) the gcloud specific library

The response of Aurelien is quite interesting

<script src="https://gist.github.com/sinsunsan/2bec4f3970057fb2db3cd04fda6dbca1.js"></script>

Yes I found the source!

Google cloud
> google-cloud is a client library for accessing Google Cloud Platform services that significantly reduces the boilerplate code you have to write.

Yes, I do not like writing boiler plate code! After hours of search I am quite happy to see this promise of simplicity.

![Google cloud]({{site.baseurl}}/images/gcloud-client-header.png)
[https://googlecloudplatform.github.io/google-cloud-node/#/]( https://googlecloudplatform.github.io/google-cloud-node/#/)

And google cloud is the recommanded way, good to know....

> The Google APIs Node.js Client is a client library for using the broad set of Google APIs. google-cloud is built specifically for the Google Cloud Platform and is the recommended way to integrate Google Cloud APIs into your Node.js applications. If your application requires both Google Cloud Platform and other Google APIs, the 2 libraries may be used by your application.


Here is a much more detailed description on how to authenticate with google-cloud SDK (not be mistaken with gcloud the command line utility)
[https://googlecloudplatform.github.io/google-cloud-node/#/docs/google-cloud/0.45.0/guides/authentication](https://googlecloudplatform.github.io/google-cloud-node/#/docs/google-cloud/0.45.0/guides/authentication)
